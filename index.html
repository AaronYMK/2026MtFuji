<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>2026 日本旅行</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Shippori+Mincho:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-color: #fcfcfc; /* 極簡白背景 */
            --card-bg: #ffffff;
            --text-main: #333333;
            --text-serif: 'Shippori Mincho', serif; /* 標題專用字體 */
            --text-sans: 'Noto Sans TC', sans-serif;
            --accent-red: #a83232; /* 圖片中的深紅色 */
            --text-light: #888888;
            --shadow-soft: 0 4px 20px rgba(0,0,0,0.04);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: var(--text-sans);
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding-bottom: 90px;
        }

        /* --- 頂部導航 (還原圖片) --- */
        header {
            background: var(--bg-color);
            padding: 15px 0 0 0;
            position: sticky;
            top: 0;
            z-index: 100;
            text-align: center;
        }
        .trip-tag {
            font-size: 0.6rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--text-light);
            margin-bottom: 5px;
            display: block;
        }
        .trip-title-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .trip-title {
            font-family: var(--text-serif);
            font-size: 1.4rem;
            font-weight: 500;
        }
        .year-pill {
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 2px 8px;
            font-size: 0.7rem;
            color: var(--text-light);
            font-family: var(--text-sans);
        }

        /* --- 日期選擇器 (還原圖片: 星期在上，日期在下，紅點) --- */
        .date-scroller {
            display: flex;
            overflow-x: auto;
            padding: 10px 20px 20px 20px;
            gap: 25px;
            scrollbar-width: none;
            border-bottom: 1px solid #f0f0f0;
            background: var(--bg-color);
        }
        .date-scroller::-webkit-scrollbar { display: none; }
        
        .date-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 40px;
            color: #bbb;
            cursor: pointer;
            position: relative;
            transition: color 0.3s;
        }
        .date-item.active {
            color: var(--text-main);
        }
        .d-day {
            font-size: 0.65rem;
            font-weight: 700;
            margin-bottom: 5px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        .d-date {
            font-family: var(--text-serif);
            font-size: 1.4rem;
            line-height: 1;
        }
        /* 選中時的小紅點 */
        .date-item.active::after {
            content: '';
            width: 4px;
            height: 4px;
            background-color: var(--accent-red);
            border-radius: 50%;
            position: absolute;
            bottom: -10px;
        }

        /* --- Hero Banner (還原圖片: 圖片背景+文字) --- */
        .hero-section {
            padding: 20px;
        }
        .hero-card {
            background-size: cover;
            background-position: center;
            height: 160px;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: flex-end;
            box-shadow: var(--shadow-soft);
        }
        /* 漸層遮罩讓文字清楚 */
        .hero-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,0.7) 100%);
        }
        .hero-content {
            position: relative;
            z-index: 2;
            padding: 15px;
            color: white;
            width: 100%;
        }
        .hero-badge {
            border: 1px solid rgba(255,255,255,0.6);
            padding: 2px 8px;
            font-size: 0.7rem;
            display: inline-block;
            margin-bottom: 8px;
            backdrop-filter: blur(4px);
        }
        .hero-title {
            font-family: var(--text-serif);
            font-size: 1.2rem;
            font-weight: 500;
            margin: 0;
            letter-spacing: 1px;
        }

        /* --- 天氣區塊 (還原圖片: Open-Meteo 風格) --- */
        .weather-section {
            padding: 10px 20px;
            position: relative;
        }
        .weather-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 15px;
        }
        .weather-loc {
            font-family: var(--text-serif);
            font-size: 1.5rem;
            color: var(--text-main);
            margin: 0;
        }
        .weather-sub {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 5px;
        }
        .weather-source {
            font-size: 0.7rem;
            color: #ccc;
            font-weight: 300;
        }
        /* 橫向捲動天氣 */
        .weather-scroller {
            display: flex;
            overflow-x: auto;
            gap: 25px;
            scrollbar-width: none;
            padding-bottom: 10px;
        }
        .weather-scroller::-webkit-scrollbar { display: none; }
        
        .w-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 45px;
            text-align: center;
        }
        .w-time { font-size: 0.8rem; color: var(--text-light); margin-bottom: 10px; }
        .w-icon { font-size: 1.4rem; color: var(--text-main); margin-bottom: 10px; }
        .w-temp { font-family: var(--text-serif); font-size: 1.1rem; }

        /* --- 分割線 --- */
        .divider {
            height: 1px;
            background: #eee;
            margin: 10px 20px;
        }

        /* --- 住宿資訊 (還原圖片: 紅色豎線) --- */
        .hotel-section {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .hotel-info-box {
            display: flex;
            align-items: center;
        }
        .hotel-accent {
            width: 3px;
            height: 35px;
            background-color: #d8a4a4; /* 淡紅色 */
            margin-right: 15px;
        }
        .hotel-texts h4 {
            margin: 0;
            font-size: 0.7rem;
            color: var(--text-light);
            font-weight: 400;
            letter-spacing: 1px;
        }
        .hotel-texts p {
            margin: 3px 0 0 0;
            font-family: var(--text-serif);
            font-size: 1.1rem;
            color: var(--text-main);
        }
        .hotel-action {
            color: var(--text-light);
            font-size: 1.2rem;
        }

        /* --- 行程卡片 (仿時間軸設計) --- */
        .timeline-container {
            padding: 10px 20px;
        }
        .t-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.06);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            position: relative;
            border: 1px solid #f9f9f9;
        }
        /* 左側圖示區 */
        .t-left {
            width: 50px;
            text-align: center;
            border-right: 1px dashed #eee;
            padding-right: 15px;
            margin-right: 15px;
            color: var(--text-light);
        }
        .t-left i { font-size: 1.2rem; display: block; margin-bottom: 5px; }
        .t-left span { font-size: 0.6rem; text-transform: uppercase; }

        /* 中間內容 */
        .t-content { flex: 1; }
        .t-time { font-family: var(--text-serif); font-size: 1.8rem; line-height: 1; margin-bottom: 5px; }
        .t-time span { font-size: 0.8rem; font-family: var(--text-sans); background: #f0f0f0; padding: 2px 6px; border-radius: 4px; vertical-align: middle; margin-left: 5px; color: #666; }
        .t-title { font-size: 1rem; font-weight: 500; margin-bottom: 5px; }
        .t-sub { font-size: 0.8rem; color: var(--text-light); display: flex; align-items: center; gap: 5px; }
        
        /* 右側下一站 */
        .t-right {
            text-align: right;
            padding-left: 10px;
        }
        .t-next-time { font-family: var(--text-serif); font-size: 1.1rem; color: var(--text-main); }
        .t-next-label { font-size: 0.6rem; color: var(--text-light); }

        /* --- 錢包與計算機 --- */
        .wallet-card {
            background: white;
            margin: 20px;
            padding: 25px;
            border-radius: 16px;
            box-shadow: var(--shadow-soft);
            text-align: center;
        }
        .calc-box {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
        }
        .calc-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .calc-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 8px;
            font-size: 1rem;
            text-align: right;
        }
        .calc-result {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text-main);
            text-align: right;
            padding: 10px;
        }

        /* 底部導航 */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 10px 20px;
            display: flex; justify-content: space-around;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            border: 1px solid rgba(0,0,0,0.05);
        }
        .nav-btn { background: none; border: none; color: #ccc; font-size: 1.2rem; padding: 10px; transition: color 0.3s; }
        .nav-btn.active { color: var(--text-main); }

        /* 隱藏內容區塊 */
        .view-section { display: none; }
        .view-section.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Point & Speak 樣式 (沿用功能) */
        .btn-action {
            display: inline-block; background: #f0f0f0; padding: 5px 10px; 
            border-radius: 4px; font-size: 0.75rem; text-decoration: none; color: #333; margin-top: 5px;
        }
    </style>
</head>
<body>

<header>
    <span class="trip-tag">FAMILY TRIP</span>
    <div class="trip-title-row">
        <span class="trip-title">東京河口湖之旅</span>
        <span class="year-pill">2026</span>
    </div>
</header>

<div id="view-trip" class="view-section active">
    
    <div class="date-scroller">
        </div>

    <div class="hero-section">
        <div class="hero-card" id="heroCard" style="background-image: url('https://images.unsplash.com/photo-1528164344705-47542687000d?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80');">
            <div class="hero-content">
                <div class="hero-badge" id="heroDayBadge">DAY 1</div>
                <div style="font-size:0.8rem; margin-bottom:2px;"><i class="fas fa-map-marker-alt"></i> <span id="heroLoc">東京市區</span></div>
                <h2 class="hero-title" id="heroTitle">出發 & 新宿之夜</h2>
            </div>
        </div>
    </div>

    <div class="weather-section">
        <div class="weather-header">
            <div>
                <h3 class="weather-loc" id="wLocName">Tokyo</h3>
                <div class="weather-sub">未來 24 小時預報</div>
            </div>
            <div class="weather-source">Open-Meteo</div>
        </div>
        <div class="weather-scroller" id="weatherScroll">
            <div style="width:100%; text-align:center; padding:20px; color:#999;">
                <i class="fas fa-spinner fa-spin"></i> 載入氣象中...
            </div>
        </div>
    </div>

    <div class="divider"></div>

    <div class="hotel-section">
        <div class="hotel-info-box">
            <div class="hotel-accent"></div>
            <div class="hotel-texts">
                <h4>住宿資訊 Accommodation Info</h4>
                <p id="hotelName">The Blossom Kumamoto</p>
            </div>
        </div>
        <div class="hotel-action">
            <i class="fas fa-download"></i>
        </div>
    </div>

    <div class="divider"></div>

    <div id="itinerary-list" class="timeline-container">
        </div>
</div>

<div id="view-wallet" class="view-section">
    <div class="wallet-card">
        <div style="font-size:0.8rem; color:#888; margin-bottom:5px;">總支出 TOTAL (TWD)</div>
        <div style="font-family: var(--text-serif); font-size: 2.5rem; color:#333;" id="totalTwd">$0</div>
        <div style="font-size:0.9rem; color:#888;">約 JPY <span id="totalJpy">0</span></div>
        
        <div style="margin-top:20px; display:flex; gap:10px;">
            <input type="text" id="expName" placeholder="項目 (e.g. 晚餐)" class="calc-input" style="text-align:left;">
            <input type="number" id="expCost" placeholder="JPY" class="calc-input">
        </div>
        <button onclick="addExpense()" style="width:100%; margin-top:10px; background:#333; color:white; border:none; padding:12px; border-radius:8px;">記一筆</button>
    </div>

    <div style="padding: 0 20px;">
        <h3 style="font-size:1rem; color:#666;">匯率計算機 Rate Calc</h3>
        <div class="calc-box">
            <div class="calc-row">
                <span>JPY</span>
                <input type="number" id="calcJpy" class="calc-input" oninput="calculateRate()" placeholder="輸入日幣">
            </div>
            <div style="text-align:center; color:#ccc;"><i class="fas fa-arrow-down"></i> <span style="font-size:0.8rem">Rate: 0.22</span></div>
            <div class="calc-row">
                <span>TWD</span>
                <div id="calcTwd" class="calc-result">$0</div>
            </div>
        </div>

        <h3 style="font-size:1rem; color:#666; margin-top:30px;">支出明細</h3>
        <div id="expenseList"></div>
        <button onclick="clearExpenses()" style="margin-top:20px; width:100%; border:none; background:none; color:#a83232; padding-bottom:30px;">清除所有紀錄</button>
    </div>
</div>

<nav class="bottom-nav">
    <button class="nav-btn active" onclick="switchView('trip', this)"><i class="fas fa-map-marked-alt"></i></button>
    <button class="nav-btn" onclick="switchView('wallet', this)"><i class="fas fa-wallet"></i></button>
</nav>

<script>
    // --- 數據資料 ---
    const RATE = 0.22; // 匯率
    const itineraryData = [
        {
            day: 1, date: "26", weekday: "MON", title: "出發 & 新宿", location: {lat: 35.6938, lon: 139.7034, name: "Shinjuku City"},
            bg: "https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=800",
            hotel: "Yksi Stay Shinjuku",
            events: [
                { time: "09:30", endTime: "13:30", title: "CI 100 起飛", desc: "TPE ➝ NRT", icon: "fa-plane", type: "Flight" },
                { time: "15:14", endTime: "16:45", title: "NEX 成田特快", desc: "前往新宿站", icon: "fa-train", type: "Train" },
                { time: "18:00", endTime: "19:00", title: "牛かつもと村", desc: "必吃炸牛排", icon: "fa-utensils", type: "Dinner" },
                { time: "22:30", endTime: "23:30", title: "一蘭拉麵", desc: "新宿店宵夜", icon: "fa-bowl-rice", type: "Late Night" }
            ]
        },
        {
            day: 2, date: "27", weekday: "TUE", title: "富士山自駕", location: {lat: 35.4981, lon: 138.7686, name: "Fujikawaguchiko"},
            bg: "https://images.unsplash.com/photo-1490806843957-31f4c9a91c65?w=800",
            hotel: "秀峰閣湖月",
            events: [
                { time: "09:45", endTime: "10:00", title: "Budget 租車", desc: "河口湖站前取車", icon: "fa-car", type: "Rental" },
                { time: "10:45", endTime: "11:45", title: "忍野八海", desc: "富士山清泉", icon: "fa-water", type: "Sightseeing" },
                { time: "12:00", endTime: "13:00", title: "こし路", desc: "午餐：牛肉燉飯", icon: "fa-utensils", type: "Lunch" }
            ]
        },
        {
            day: 3, date: "28", weekday: "WED", title: "河口湖深度", location: {lat: 35.5165, lon: 138.7562, name: "Fujikawaguchiko"},
            bg: "https://images.unsplash.com/photo-1578271887552-5ac3a72752bc?w=800",
            hotel: "秀峰閣湖月",
            events: [
                { time: "10:45", endTime: "11:45", title: "手打うどん 彩花", desc: "吉田烏龍麵", icon: "fa-utensils", type: "Lunch" },
                { time: "12:15", endTime: "14:00", title: "天上山公園纜車", desc: "兔子神社", icon: "fa-mountain", type: "Spot" },
                { time: "14:30", endTime: "15:30", title: "天空鳥居", desc: "河口湖遙拝所", icon: "fa-torii-gate", type: "Spot" }
            ]
        },
        {
            day: 4, date: "29", weekday: "THU", title: "下吉田懷舊", location: {lat: 35.4849, lon: 138.8037, name: "Shimoyoshida"},
            bg: "https://images.unsplash.com/photo-1570459027562-4a916cc6113f?w=800",
            hotel: "The Knot Tokyo",
            events: [
                { time: "12:00", endTime: "13:00", title: "新倉山淺間公園", desc: "五重塔與富士山", icon: "fa-camera", type: "Spot" },
                { time: "14:45", endTime: "15:00", title: "日川時計店", desc: "懷舊商店街", icon: "fa-clock", type: "Photo" },
                { time: "19:30", endTime: "21:00", title: "焼肉うしふじ", desc: "高級和牛燒肉", icon: "fa-fire", type: "Dinner" }
            ]
        },
        {
            day: 5, date: "30", weekday: "FRI", title: "返程", location: {lat: 35.6938, lon: 139.7034, name: "Shinjuku"},
            bg: "https://images.unsplash.com/photo-1542051841857-5f90071e7989?w=800",
            hotel: "Home Sweet Home",
            events: [
                { time: "08:45", endTime: "09:45", title: "らぁ麺や 嶋", desc: "排隊名店", icon: "fa-utensils", type: "Breakfast" },
                { time: "12:30", endTime: "13:30", title: "高島屋 & 手創館", desc: "最後採買", icon: "fa-shopping-bag", type: "Shopping" },
                { time: "15:08", endTime: "16:31", title: "NEX 37號", desc: "前往成田機場", icon: "fa-train", type: "Transport" }
            ]
        }
    ];

    let currentDayIdx = 0;

    // --- 初始化 ---
    function init() {
        renderDateScroller();
        switchDay(0);
        loadExpenses();
    }

    // --- 日期選擇器 ---
    function renderDateScroller() {
        const scroller = document.querySelector('.date-scroller');
        let html = '';
        itineraryData.forEach((d, idx) => {
            html += `
            <div class="date-item ${idx===0 ? 'active' : ''}" onclick="switchDay(${idx})">
                <span class="d-day">${d.weekday}</span>
                <span class="d-date">${d.date}</span>
            </div>`;
        });
        scroller.innerHTML = html;
    }

    // --- 切換日期主邏輯 ---
    function switchDay(idx) {
        currentDayIdx = idx;
        const data = itineraryData[idx];

        // 1. Update Dates UI
        document.querySelectorAll('.date-item').forEach((el, i) => el.classList.toggle('active', i === idx));

        // 2. Update Hero
        document.getElementById('heroCard').style.backgroundImage = `url('${data.bg}')`;
        document.getElementById('heroDayBadge').innerText = `DAY ${data.day}`;
        document.getElementById('heroLoc').innerText = data.location.name;
        document.getElementById('heroTitle').innerText = data.title;

        // 3. Update Weather (Fetch API)
        fetchWeather(data.location);

        // 4. Update Hotel
        document.getElementById('hotelName').innerText = data.hotel;

        // 5. Render Itinerary
        const list = document.getElementById('itinerary-list');
        let listHtml = '';
        data.events.forEach(evt => {
            listHtml += `
            <div class="t-card">
                <div class="t-left">
                    <i class="fas ${evt.icon}"></i>
                    <span>${evt.type}</span>
                </div>
                <div class="t-content">
                    <div class="t-time">${evt.time} <span>行程</span></div>
                    <div class="t-title">${evt.title}</div>
                    <div class="t-sub"><i class="fas fa-location-arrow"></i> ${evt.desc}</div>
                </div>
                <div class="t-right">
                    <div class="t-next-time">${evt.endTime}</div>
                    <div class="t-next-label">結束</div>
                </div>
            </div>`;
        });
        list.innerHTML = listHtml;
    }

    // --- Open-Meteo API (每小時預報) ---
    async function fetchWeather(loc) {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${loc.lat}&longitude=${loc.lon}&hourly=temperature_2m,weathercode&forecast_days=1&timezone=auto`;
        document.getElementById('wLocName').innerText = loc.name;
        
        try {
            const res = await fetch(url);
            const data = await res.json();
            const hours = data.hourly.time;
            const temps = data.hourly.temperature_2m;
            const codes = data.hourly.weathercode;
            
            let html = '';
            // 只取接下來 24 小時的幾個點 (每隔 2 小時)
            const nowHour = new Date().getHours();
            
            for(let i=0; i<24; i+=2) { // 簡化顯示，每2小時一格
                const timeStr = hours[i].split('T')[1].substring(0,5);
                const temp = Math.round(temps[i]);
                const code = codes[i];
                let icon = "fa-sun";
                if(code > 3) icon = "fa-cloud";
                if(code > 50) icon = "fa-umbrella";
                
                // 模擬 "現在"
                let label = timeStr;
                if (i === 0) label = "現在";

                html += `
                <div class="w-item">
                    <span class="w-time">${label}</span>
                    <i class="fas ${icon} w-icon"></i>
                    <span class="w-temp">${temp}°</span>
                </div>`;
            }
            document.getElementById('weatherScroll').innerHTML = html;

        } catch (e) {
            document.getElementById('weatherScroll').innerHTML = "無法取得天氣資訊";
        }
    }

    // --- 錢包與匯率計算機 ---
    function calculateRate() {
        const jpy = document.getElementById('calcJpy').value;
        const twd = Math.round(jpy * RATE);
        document.getElementById('calcTwd').innerText = `$${twd.toLocaleString()}`;
    }

    function addExpense() {
        const name = document.getElementById('expName').value;
        const cost = parseInt(document.getElementById('expCost').value);
        if(!name || !cost) return;

        const saved = JSON.parse(localStorage.getItem('tripExp2026')) || [];
        saved.push({ name, cost, id: Date.now() });
        localStorage.setItem('tripExp2026', JSON.stringify(saved));
        
        document.getElementById('expName').value = '';
        document.getElementById('expCost').value = '';
        loadExpenses();
    }

    function loadExpenses() {
        const saved = JSON.parse(localStorage.getItem('tripExp2026')) || [];
        const list = document.getElementById('expenseList');
        list.innerHTML = '';
        let totalJpy = 0;

        saved.reverse().forEach(item => {
            totalJpy += item.cost;
            const twd = Math.round(item.cost * RATE);
            list.innerHTML += `
            <div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #eee;">
                <span>${item.name}</span>
                <div style="text-align:right;">
                    <div style="font-weight:500;">¥${item.cost.toLocaleString()}</div>
                    <div style="font-size:0.8rem; color:#999;">(NT$${twd.toLocaleString()})</div>
                </div>
            </div>`;
        });

        const totalTwd = Math.round(totalJpy * RATE);
        document.getElementById('totalJpy').innerText = totalJpy.toLocaleString();
        document.getElementById('totalTwd').innerText = '$' + totalTwd.toLocaleString();
    }

    function clearExpenses() {
        if(confirm("確定刪除所有記帳？")) {
            localStorage.removeItem('tripExp2026');
            loadExpenses();
        }
    }

    function switchView(view, btn) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.getElementById('view-' + view).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
    }

    init();
</script>
</body>
</html>
