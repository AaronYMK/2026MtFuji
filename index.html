<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>2026 東京河口湖</title>
    
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Shippori+Mincho:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            /* 配色改為天空水藍色調 */
            --bg-color: #f8fafc;
            --text-main: #0f172a;
            --text-serif: 'Shippori Mincho', serif;
            --text-sans: 'Noto Sans TC', sans-serif;
            --primary-blue: #0ea5e9; /* 天空藍 */
            --light-blue: #e0f2fe;
            --accent-orange: #f97316; /* 用於重點標示 */
            --text-light: #64748b;
            --shadow-card: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --radius: 16px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: var(--text-sans);
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding-bottom: 110px; /* 預留底部導航空間 */
        }

        /* --- 全螢幕大字卡 Modal --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 2000;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            padding: 30px; text-align: center;
            animation: slideUp 0.3s ease-out;
        }
        .modal-overlay.active { display: flex; }
        @keyframes slideUp { from {transform: translateY(100%);} to {transform: translateY(0);} }
        
        .modal-tag {
            color: var(--primary-blue); border: 1px solid var(--primary-blue);
            padding: 5px 15px; border-radius: 50px; font-size: 0.8rem; margin-bottom: 20px;
            letter-spacing: 2px;
        }
        .modal-jp {
            font-family: var(--text-serif); font-size: 3.5rem; font-weight: 800;
            line-height: 1.2; margin-bottom: 10px; color: #000;
        }
        .modal-sub { font-size: 1.2rem; color: #666; margin-bottom: 40px; }
        .modal-close-btn {
            position: absolute; bottom: 50px;
            background: #000; color: #fff; border: none;
            padding: 15px 40px; border-radius: 30px; font-size: 1rem;
            cursor: pointer;
        }

        /* --- 頂部導航 --- */
        header {
            background: rgba(248,250,252, 0.95);
            backdrop-filter: blur(8px);
            padding: 20px 0 10px 0;
            position: sticky; top: 0; z-index: 100;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
        }
        .trip-tag {
            font-size: 0.65rem; letter-spacing: 3px; text-transform: uppercase;
            color: var(--primary-blue); font-weight: 700; display: block; margin-bottom: 5px;
        }
        .trip-title {
            font-family: var(--text-serif); font-size: 1.4rem; font-weight: 600; letter-spacing: 1px;
        }
        .year-pill {
            background: var(--light-blue); color: var(--primary-blue);
            padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; vertical-align: middle; margin-left: 8px;
        }

        /* --- 日期選擇器 --- */
        .date-scroller {
            display: flex; overflow-x: auto; padding: 15px 20px; gap: 25px;
            scrollbar-width: none; background: var(--bg-color);
        }
        .date-scroller::-webkit-scrollbar { display: none; }
        .date-item {
            display: flex; flex-direction: column; align-items: center; min-width: 45px;
            color: #94a3b8; cursor: pointer; transition: 0.3s;
        }
        .date-item.active { color: var(--primary-blue); transform: scale(1.05); }
        .d-day { font-size: 0.7rem; font-weight: 700; margin-bottom: 4px; }
        .d-date { font-family: var(--text-serif); font-size: 1.5rem; line-height: 1; }
        .date-item.active .d-date { font-weight: 800; border-bottom: 2px solid var(--primary-blue); padding-bottom: 2px;}

        /* --- Hero Banner --- */
        .hero-section { padding: 10px 20px 20px; }
        .hero-card {
            background-size: cover; background-position: center; height: 160px;
            border-radius: var(--radius); position: relative; overflow: hidden;
            display: flex; align-items: flex-end; box-shadow: var(--shadow-card);
        }
        .hero-card::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 60%);
        }
        .hero-content { position: relative; z-index: 2; padding: 20px; color: white; width: 100%; }
        .hero-badge {
            background: rgba(255,255,255,0.2); backdrop-filter: blur(4px);
            padding: 4px 10px; font-size: 0.7rem; border-radius: 4px; display: inline-block; margin-bottom: 8px;
        }
        .hero-title { font-family: var(--text-serif); font-size: 1.3rem; margin: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }

        /* --- 天氣 --- */
        .weather-section { padding: 0 25px; margin-bottom: 20px; }
        .weather-scroll { display: flex; overflow-x: auto; gap: 30px; padding-bottom: 10px; scrollbar-width: none; }
        .weather-scroll::-webkit-scrollbar { display: none; }
        .w-item { text-align: center; min-width: 40px; }
        .w-time { font-size: 0.8rem; color: var(--text-light); margin-bottom: 8px; }
        .w-icon { font-size: 1.2rem; color: var(--primary-blue); margin-bottom: 8px; }
        .w-temp { font-family: var(--text-serif); font-weight: 600; }

        /* --- Day 3 切換開關 --- */
        .plan-toggle-container { padding: 0 20px 15px; display: none; } /* JS控制顯示 */
        .plan-toggle {
            background: #e2e8f0; border-radius: 50px; padding: 4px; display: flex; position: relative;
        }
        .plan-btn {
            flex: 1; border: none; background: none; padding: 8px; border-radius: 50px;
            font-size: 0.9rem; color: #64748b; font-weight: 500; cursor: pointer; z-index: 2; transition: 0.3s;
        }
        .plan-btn.active { color: var(--primary-blue); background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* --- 行程卡片 --- */
        .timeline-container { padding: 10px 20px; }
        .t-card {
            background: white; border-radius: var(--radius); padding: 20px;
            box-shadow: var(--shadow-card); margin-bottom: 20px;
            position: relative; border-left: 4px solid transparent;
        }
        .t-card.type-Food { border-left-color: var(--accent-orange); }
        .t-card.type-Spot { border-left-color: var(--primary-blue); }
        
        .t-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .t-time { font-family: var(--text-serif); font-size: 1.8rem; line-height: 1; color: var(--text-main); }
        .t-tag { 
            font-size: 0.65rem; background: #f1f5f9; padding: 4px 8px; border-radius: 4px; 
            color: var(--text-light); text-transform: uppercase; letter-spacing: 1px;
        }
        
        .t-title { font-size: 1.2rem; font-weight: 700; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;}
        .must-eat { background: var(--accent-orange); color: white; font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; }
        
        /* 智能導遊文字 */
        .smart-guide {
            font-size: 0.9rem; color: #475569; line-height: 1.6; 
            background: #f8fafc; padding: 12px; border-radius: 8px; margin: 10px 0;
            border-left: 2px solid #cbd5e1;
        }
        .guide-label { font-size: 0.7rem; color: var(--primary-blue); font-weight: 700; display: block; margin-bottom: 4px; }

        /* 功能按鈕區 */
        .action-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn-action {
            background: #f1f5f9; border: none; padding: 10px; border-radius: 8px;
            color: var(--text-main); font-size: 0.85rem; display: flex; align-items: center; justify-content: center; gap: 6px;
            text-decoration: none; cursor: pointer; transition: 0.2s;
        }
        .btn-action:active { transform: scale(0.98); }
        .btn-highlight { background: var(--light-blue); color: var(--primary-blue); font-weight: 500; }
        .btn-full { grid-column: span 2; }

        /* --- 記帳與資訊頁 --- */
        .info-card { background: white; border-radius: var(--radius); padding: 20px; box-shadow: var(--shadow-card); margin-bottom: 20px; }
        .info-header { border-bottom: 1px solid #f1f5f9; padding-bottom: 10px; margin-bottom: 15px; font-weight: 700; color: var(--primary-blue); }
        
        /* 匯率計算機 */
        .calc-row { display: flex; align-items: center; background: #f8fafc; border-radius: 12px; padding: 10px; margin-bottom: 10px; }
        .calc-input { border: none; background: transparent; font-size: 1.2rem; text-align: right; width: 100%; outline: none; }
        
        /* 記帳列表 */
        .expense-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px dashed #e2e8f0; }
        .btn-del { color: #ef4444; background: none; border: none; padding: 5px; font-size: 1rem; cursor: pointer; margin-left: 10px;}

        /* --- 底部導航 --- */
        .bottom-nav {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);
            border-radius: 40px; padding: 10px 30px;
            display: flex; justify-content: space-between;
            box-shadow: 0 10px 30px rgba(14, 165, 233, 0.15); z-index: 1000;
            border: 1px solid rgba(255,255,255,0.5);
        }
        .nav-btn { background: none; border: none; color: #94a3b8; font-size: 1.3rem; padding: 8px; transition: 0.3s; }
        .nav-btn.active { color: var(--primary-blue); transform: translateY(-3px); }

        /* View 切換 */
        .view-section { display: none; animation: fadeIn 0.4s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    </style>
</head>
<body>

<div id="fullModal" class="modal-overlay">
    <div id="modalTag" class="modal-tag">POINT & SPEAK</div>
    <div id="modalJp" class="modal-jp">日本語</div>
    <div id="modalSub" class="modal-sub">中文意思</div>
    <button class="modal-close-btn" onclick="closeModal()">關閉 Close</button>
</div>

<header>
    <span class="trip-tag">FAMILY TRIP 2026</span>
    <div class="trip-title">東京河口湖之旅 <span class="year-pill">JP</span></div>
</header>

<div id="view-trip" class="view-section active">
    
    <div class="date-scroller" id="dateScroller">
        </div>

    <div class="hero-section">
        <div class="hero-card" id="heroCard">
            <div class="hero-content">
                <div class="hero-badge" id="heroDayBadge">DAY 1</div>
                <h2 class="hero-title" id="heroTitle">出發 & 新宿之夜</h2>
            </div>
        </div>
    </div>

    <div class="weather-section">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; align-items:flex-end;">
            <div>
                <span style="font-size:1.5rem; font-family:var(--text-serif);" id="wLoc">Tokyo</span>
                <div style="font-size:0.75rem; color:#94a3b8;">未來 24 小時預報</div>
            </div>
            <i class="fas fa-cloud-sun" style="color:var(--primary-blue); font-size:1.5rem;"></i>
        </div>
        <div class="weather-scroll" id="weatherScroll">
            </div>
    </div>

    <div class="plan-toggle-container" id="planToggle">
        <div class="plan-toggle">
            <button class="plan-btn active" onclick="switchPlan('A')">☀️ 晴天方案</button>
            <button class="plan-btn" onclick="switchPlan('B')">❄️ 雪天備案</button>
        </div>
    </div>

    <div id="itinerary-list" class="timeline-container">
        </div>
</div>

<div id="view-wallet" class="view-section" style="padding:20px;">
    
    <div class="info-card">
        <div class="info-header"><i class="fas fa-calculator"></i> 匯率計算機 (Rate: 0.22)</div>
        <div class="calc-row">
            <span style="font-weight:bold; color:#64748b; width:50px;">JPY</span>
            <input type="number" id="calcJpy" class="calc-input" placeholder="0" oninput="calculate('jpy')">
        </div>
        <div style="text-align:center; color:#cbd5e1; margin:5px 0;"><i class="fas fa-arrow-down"></i></div>
        <div class="calc-row">
            <span style="font-weight:bold; color:#64748b; width:50px;">TWD</span>
            <input type="number" id="calcTwd" class="calc-input" placeholder="0" oninput="calculate('twd')">
        </div>
    </div>

    <div class="info-card">
        <div style="text-align:center; padding-bottom:15px; border-bottom:1px solid #f1f5f9; margin-bottom:15px;">
            <div style="font-size:0.8rem; color:#94a3b8;">總支出 Total (TWD)</div>
            <div style="font-size:2.5rem; font-family:var(--text-serif); color:var(--text-main);" id="totalTwd">$0</div>
            <div style="font-size:0.9rem; color:#94a3b8;">約 JPY <span id="totalJpy">0</span></div>
        </div>

        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <input type="text" id="expName" style="flex:1; padding:10px; border:1px solid #cbd5e1; border-radius:8px;" placeholder="項目">
            <input type="number" id="expCost" style="width:80px; padding:10px; border:1px solid #cbd5e1; border-radius:8px;" placeholder="JPY">
            <button onclick="addExpense()" style="background:var(--text-main); color:white; border:none; padding:0 15px; border-radius:8px;">+</button>
        </div>

        <div id="expenseList"></div>
        
        <button onclick="clearAllExpenses()" style="width:100%; margin-top:20px; border:none; background:none; color:#ef4444; font-size:0.8rem;">清除所有紀錄</button>
    </div>
</div>

<div id="view-info" class="view-section" style="padding:20px;">
    
    <div class="info-card">
        <div class="info-header"><i class="fas fa-plane"></i> 航班資訊 Flight</div>
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
            <div>
                <div style="font-weight:bold;">去程 CI 100</div>
                <div style="font-size:0.85rem; color:#64748b;">09:30 TPE ➝ 13:30 NRT</div>
            </div>
            <div style="text-align:right;">
                <span style="background:#e0f2fe; color:#0ea5e9; padding:2px 6px; border-radius:4px; font-size:0.7rem;">已確認</span>
            </div>
        </div>
        <div style="display:flex; justify-content:space-between;">
            <div>
                <div style="font-weight:bold;">回程 CI 109</div>
                <div style="font-size:0.85rem; color:#64748b;">20:00 NRT ➝ 22:55 TPE</div>
            </div>
            <div style="text-align:right;">
                <span style="background:#e0f2fe; color:#0ea5e9; padding:2px 6px; border-radius:4px; font-size:0.7rem;">已確認</span>
            </div>
        </div>
    </div>

    <div class="info-card">
        <div class="info-header"><i class="fas fa-ticket-alt"></i> 訂位與預約代碼</div>
        <div style="margin-bottom:10px;">
            <div style="font-size:0.8rem; color:#94a3b8;">機票 Booking Ref</div>
            <div style="font-family:monospace; font-size:1.1rem; letter-spacing:1px;">6Y2K9Z</div>
        </div>
        <div style="margin-bottom:10px;">
            <div style="font-size:0.8rem; color:#94a3b8;">租車 Budget Car</div>
            <div style="font-family:monospace; font-size:1.1rem; letter-spacing:1px;">RC-2026-888</div>
        </div>
        <div>
            <div style="font-size:0.8rem; color:#94a3b8;">秀峰閣湖月</div>
            <div style="font-family:monospace; font-size:1.1rem; letter-spacing:1px;">H-992100</div>
        </div>
    </div>

    <div class="info-card">
        <div class="info-header"><i class="fas fa-phone-alt"></i> 緊急聯絡</div>
        <div class="action-row">
            <a href="tel:110" class="btn-action"><i class="fas fa-user-shield"></i> 警察 110</a>
            <a href="tel:119" class="btn-action"><i class="fas fa-ambulance"></i> 救護 119</a>
        </div>
        <div style="margin-top:10px; font-size:0.8rem; color:#64748b; line-height:1.5;">
            駐日代表處急難救助：<br>
            <a href="tel:+81-80-1009-7179" style="color:var(--primary-blue); text-decoration:none; font-weight:bold;">+81-80-1009-7179</a>
        </div>
    </div>
</div>

<nav class="bottom-nav">
    <button class="nav-btn active" onclick="switchView('trip', this)"><i class="fas fa-map-marked-alt"></i></button>
    <button class="nav-btn" onclick="switchView('wallet', this)"><i class="fas fa-wallet"></i></button>
    <button class="nav-btn" onclick="switchView('info', this)"><i class="fas fa-info-circle"></i></button>
</nav>

<script>
    // --- 核心資料與設定 ---
    const RATE = 0.22;
    let currentPlan = 'A'; // 'A' = 晴天, 'B' = 雪天

    const itineraryData = [
        {
            day: 1, date: "26", weekday: "MON", title: "出發 & 新宿之夜", 
            location: "Shinjuku",
            bg: "https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=800",
            events: [
                { time: "09:30", type: "Flight", title: "CI 100 起飛", desc: "TPE (09:30) ➝ NRT (13:30)。準備好護照與 VJW QR Code。", icon: "fa-plane" },
                { time: "15:14", type: "Train", title: "NEX 成田特快", desc: "前往新宿站。建議在車上稍微補眠，新宿車站結構複雜，出站請找「東口」。", icon: "fa-train" },
                { 
                    time: "18:00", type: "Food", title: "牛かつもと村", desc: "必吃炸牛排", icon: "fa-utensils", mustEat: "招牌炸牛排",
                    guide: "【必吃攻略】這家店的炸牛排只有炸60秒，外酥內生。請將牛排放在眼前的石盤上炙燒，聽到「滋滋」聲約3秒翻面，搭配山葵與醬油最美味！飯可以免費續一碗。",
                    pointSpeak: { jp: "牛かつ定食をください", sub: "請給我炸牛排定食" }
                },
                { 
                    time: "22:30", type: "Food", title: "一蘭拉麵", desc: "新宿店宵夜", icon: "fa-bowl-rice",
                    guide: "【點餐秘訣】湯頭濃度選「基本」或「濃」，蒜泥建議「1片份」，秘傳醬汁「2倍」是黃金比例。別忘了留一點湯，加點「替玉（加麵）」！",
                    pointSpeak: { jp: "ラーメンと半熟塩ゆで卵", sub: "拉麵與半熟蛋" }
                }
            ]
        },
        {
            day: 2, date: "27", weekday: "TUE", title: "富士山河口湖", 
            location: "Fujikawaguchiko",
            bg: "https://images.unsplash.com/photo-1490806843957-31f4c9a91c65?w=800",
            events: [
                { time: "09:45", type: "Car", title: "Budget 租車", desc: "河口湖站前取車，請出示台灣駕照+日文譯本。", icon: "fa-car" },
                { 
                    time: "10:45", type: "Spot", title: "忍野八海", desc: "神之泉湧池", icon: "fa-water",
                    guide: "【景點故事】忍野八海是富士山融雪經過80年過濾後的湧泉群，被譽為「神的泉水」。其中「湧池」最深最藍，一定要去旁邊的土產店買「草餅」，現烤熱熱的超好吃！",
                    addressJP: "山梨県南都留郡忍野村忍草"
                },
                { time: "12:00", type: "Food", title: "こし路 (Koshiji)", desc: "在地人食堂", icon: "fa-utensils", mustEat: "牛肉燴飯", guide: "這是一間觀光客很少、但在地人極推的食堂。必點牛肉燴飯，肉質軟嫩入味，份量十足。" }
            ]
        },
        {
            day: 3, date: "28", weekday: "WED", title: "河口湖深度遊", 
            location: "Fujikawaguchiko",
            bg: "https://images.unsplash.com/photo-1578271887552-5ac3a72752bc?w=800",
            hasBranch: true,
            eventsA: [ // 晴天
                { 
                    time: "10:45", type: "Food", title: "手打うどん 彩花", desc: "吉田烏龍麵", icon: "fa-utensils",
                    guide: "【美食科普】吉田烏龍麵是全日本最硬的烏龍麵！因為這裡海拔高、水質好，麵條極具嚼勁。配料通常是馬肉和高麗菜，加一點桌上的「辛味」更對味。",
                    pointSpeak: { jp: "肉うどん", sub: "肉烏龍麵" }
                },
                { 
                    time: "12:15", type: "Spot", title: "天上山公園纜車", desc: "兔子神社", icon: "fa-mountain",
                    guide: "【傳說故事】這裡是以日本童話「咔嚓咔嚓山」為背景，講述兔子懲罰壞狸貓的故事。上山後可以求個「兔子籤」，還能在絕景鞦韆上和富士山合照。",
                    addressJP: "山梨県南都留郡富士河口湖町浅川1163-1" 
                },
                { 
                    time: "14:30", type: "Spot", title: "天空鳥居", desc: "河口湖遙拝所", icon: "fa-torii-gate",
                    guide: "【拍照攻略】這是近年IG爆紅景點。建議用廣角鏡頭，由下往上拍，可以讓鳥居剛好框住富士山。因為在山上，走路請小心防滑。",
                    addressJP: "河口湖浅間神社遙拝所"
                }
            ],
            eventsB: [ // 雪天
                { time: "11:00", type: "Food", title: "ほうとう不動", desc: "不動茶屋餺飥麵", icon: "fa-utensils", guide: "雪天最適合吃熱騰騰的餺飥麵(Hoto)。這是一種加入大量南瓜和蔬菜的扁麵，湯頭濃郁甘甜，暖身首選。" },
                { 
                    time: "12:30", type: "Spot", title: "音樂盒之森美術館", desc: "歐洲庭園", icon: "fa-music",
                    guide: "【雨雪備案】這裡彷彿中世紀的歐洲，室內有世界最大的自動管風琴表演，還有沙畫演出。即使外面下大雪，在室內喝著玫瑰花茶聽音樂也非常浪漫。",
                    addressJP: "山梨県南都留郡富士河口湖町河口3077-20"
                }
            ]
        },
        {
            day: 4, date: "29", weekday: "THU", title: "下吉田懷舊", 
            location: "Shimoyoshida",
            bg: "https://images.unsplash.com/photo-1570459027562-4a916cc6113f?w=800",
            events: [
                { 
                    time: "12:00", type: "Spot", title: "新倉山淺間公園", desc: "五重塔與富士山", icon: "fa-camera",
                    guide: "【經典視角】這裡就是那張「櫻花+五重塔+富士山」明信片的拍攝地。需要爬398階樓梯，請做好心理準備，但上面的景色絕對值得！",
                    addressJP: "新倉山浅間公園"
                },
                { 
                    time: "19:30", type: "Food", title: "焼肉うしふじ", desc: "高級和牛燒肉", icon: "fa-fire",
                    guide: "【高級饗宴】這裡提供A5等級的黑毛和牛。建議點「稀有部位拼盤」，每一口都是油脂的香氣。這家店裝潢很時尚，是行程最後一晚的完美句點。",
                    pointSpeak: { jp: "本日の厳選和牛盛り合わせ", sub: "今日嚴選和牛拼盤" }
                }
            ]
        },
        {
            day: 5, date: "30", weekday: "FRI", title: "東京最後採買", 
            location: "Shinjuku",
            bg: "https://images.unsplash.com/photo-1542051841857-5f90071e7989?w=800",
            events: [
                { 
                    time: "08:45", type: "Food", title: "らぁ麺や 嶋", desc: "超人氣排隊名店", icon: "fa-utensils",
                    guide: "【排隊名店】東京排名前幾的醬油拉麵。湯頭使用多種地雞熬製，層次非常豐富。建議開門前一小時就去排隊，不然很容易賣完。",
                    addressJP: "東京都渋谷区西原3-7-1"
                },
                { time: "15:08", type: "Train", title: "NEX 37號", desc: "前往成田機場", icon: "fa-train" },
                { time: "19:30", type: "Flight", title: "CI 109 回程", desc: "NRT (20:00) ➝ TPE (22:55)", icon: "fa-plane" }
            ]
        }
    ];

    // --- 核心功能函數 ---

    function init() {
        renderDateScroller();
        switchDay(0);
        loadExpenses();
    }

    // 1. 渲染日期
    function renderDateScroller() {
        const scroller = document.getElementById('dateScroller');
        let html = '';
        itineraryData.forEach((d, idx) => {
            html += `
            <div class="date-item ${idx===0 ? 'active' : ''}" onclick="switchDay(${idx})">
                <span class="d-day">${d.weekday}</span>
                <span class="d-date">${d.date}</span>
            </div>`;
        });
        scroller.innerHTML = html;
    }

    // 2. 切換日期
    let currentDayIdx = 0;
    function switchDay(idx) {
        currentDayIdx = idx;
        const data = itineraryData[idx];
        
        // 更新 UI 狀態
        document.querySelectorAll('.date-item').forEach((el, i) => el.classList.toggle('active', i === idx));
        
        // 更新 Hero 資訊
        document.getElementById('heroCard').style.backgroundImage = `url('${data.bg}')`;
        document.getElementById('heroDayBadge').innerText = `DAY ${data.day}`;
        document.getElementById('heroTitle').innerText = data.title;
        document.getElementById('wLoc').innerText = data.location;
        
        // 更新天氣 (模擬)
        renderWeather();

        // 處理 Day 3 分支按鈕顯示
        const planToggle = document.getElementById('planToggle');
        if (data.hasBranch) {
            planToggle.style.display = 'block';
        } else {
            planToggle.style.display = 'none';
        }

        // 渲染列表
        renderItinerary(data);
    }

    // 3. 渲染行程列表
    function renderItinerary(data) {
        const list = document.getElementById('itinerary-list');
        let events = data.events;
        
        // 如果是 Day 3，根據方案選擇事件
        if (data.hasBranch) {
            events = (currentPlan === 'A') ? data.eventsA : data.eventsB;
        }

        let html = '';
        events.forEach(evt => {
            // 按鈕邏輯
            let actions = '';
            // 導航按鈕 (所有卡片都有)
            const mapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(evt.title)}`;
            actions += `<a href="${mapLink}" target="_blank" class="btn-action"><i class="fas fa-location-arrow"></i> 導航</a>`;
            
            // 指差確認 (餐廳)
            if (evt.pointSpeak) {
                actions += `<button onclick="showModal('POINT & SPEAK', '${evt.pointSpeak.jp}', '${evt.pointSpeak.sub}')" class="btn-action btn-highlight"><i class="fas fa-hand-point-up"></i> 給店員看</button>`;
            }
            
            // 給司機看 (有地址的景點)
            if (evt.addressJP) {
                actions += `<button onclick="showModal('TO DRIVER', '${evt.addressJP}', '${evt.title}')" class="btn-action"><i class="fas fa-taxi"></i> 給司機看</button>`;
            }

            // 必吃標籤
            const mustEatTag = evt.mustEat ? `<span class="must-eat">必吃：${evt.mustEat}</span>` : '';
            
            // 智能導遊
            const guideSection = evt.guide ? `
                <div class="smart-guide">
                    <span class="guide-label"><i class="fas fa-robot"></i> 智能導遊</span>
                    ${evt.guide}
                </div>` : '';

            html += `
            <div class="t-card type-${evt.type}">
                <div class="t-header">
                    <div class="t-time">${evt.time}</div>
                    <span class="t-tag">${evt.type}</span>
                </div>
                <div class="t-title">${evt.title} ${mustEatTag}</div>
                <div style="font-size:0.9rem; color:#64748b; margin-bottom:10px;">${evt.desc}</div>
                ${guideSection}
                <div class="action-row ${actions.includes('btn-highlight') ? '' : ''}">
                    ${actions}
                </div>
            </div>`;
        });
        list.innerHTML = html;
    }

    // 4. 切換 Day 3 方案
    function switchPlan(plan) {
        currentPlan = plan;
        document.querySelectorAll('.plan-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        // 重新渲染當前頁面
        switchDay(currentDayIdx);
    }

    // 5. 天氣模擬
    function renderWeather() {
        const container = document.getElementById('weatherScroll');
        let html = '';
        for(let i=0; i<8; i++) {
            const hour = 9 + (i*2);
            const time = `${hour}:00`;
            const temp = 8 + Math.floor(Math.random() * 5);
            html += `
            <div class="w-item">
                <div class="w-time">${time}</div>
                <i class="fas fa-sun w-icon"></i>
                <div class="w-temp">${temp}°</div>
            </div>`;
        }
        container.innerHTML = html;
    }

    // 6. Modal 控制
    function showModal(tag, mainText, subText) {
        document.getElementById('modalTag').innerText = tag;
        document.getElementById('modalJp').innerText = mainText;
        document.getElementById('modalSub').innerText = subText;
        document.getElementById('fullModal').classList.add('active');
    }
    function closeModal() {
        document.getElementById('fullModal').classList.remove('active');
    }

    // 7. 記帳功能 (單筆刪除)
    function addExpense() {
        const name = document.getElementById('expName').value;
        const cost = parseInt(document.getElementById('expCost').value);
        if(!name || !cost) return;

        const saved = JSON.parse(localStorage.getItem('tripExpenses2026')) || [];
        saved.push({ id: Date.now(), name, cost });
        localStorage.setItem('tripExpenses2026', JSON.stringify(saved));
        
        document.getElementById('expName').value = '';
        document.getElementById('expCost').value = '';
        loadExpenses();
    }

    function deleteExpense(id) {
        let saved = JSON.parse(localStorage.getItem('tripExpenses2026')) || [];
        saved = saved.filter(item => item.id !== id);
        localStorage.setItem('tripExpenses2026', JSON.stringify(saved));
        loadExpenses();
    }

    function clearAllExpenses() {
        if(confirm("確定刪除所有紀錄嗎？")) {
            localStorage.removeItem('tripExpenses2026');
            loadExpenses();
        }
    }

    function loadExpenses() {
        const saved = JSON.parse(localStorage.getItem('tripExpenses2026')) || [];
        const list = document.getElementById('expenseList');
        list.innerHTML = '';
        let totalJpy = 0;

        saved.reverse().forEach(item => {
            totalJpy += item.cost;
            const twd = Math.round(item.cost * RATE);
            list.innerHTML += `
            <div class="expense-item">
                <div style="flex:1;">
                    <div style="font-size:0.95rem;">${item.name}</div>
                    <div style="font-size:0.8rem; color:#94a3b8;">${new Date(item.id).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                </div>
                <div style="text-align:right; margin-right:10px;">
                    <div style="font-weight:bold;">¥${item.cost.toLocaleString()}</div>
                    <div style="font-size:0.8rem; color:#94a3b8;">$${twd.toLocaleString()}</div>
                </div>
                <button class="btn-del" onclick="deleteExpense(${item.id})"><i class="fas fa-times-circle"></i></button>
            </div>`;
        });

        document.getElementById('totalJpy').innerText = totalJpy.toLocaleString();
        document.getElementById('totalTwd').innerText = '$' + Math.round(totalJpy * RATE).toLocaleString();
    }

    // 8. 匯率計算機
    function calculate(source) {
        const elJpy = document.getElementById('calcJpy');
        const elTwd = document.getElementById('calcTwd');
        if(source === 'jpy') elTwd.value = Math.round(elJpy.value * RATE);
        else elJpy.value = Math.round(elTwd.value / RATE);
    }

    // 9. 頁面切換
    function switchView(viewName, btn) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.getElementById('view-' + viewName).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
        window.scrollTo(0,0);
    }

    // 初始化
    init();

</script>
</body>
</html>
